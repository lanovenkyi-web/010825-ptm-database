## Оператор группировки GROUP BY

В MySQL GROUP BY используется для группировки строк с одинаковыми значениями в одном или нескольких столбцах. Часто применяется с агрегирующими функциями, такими как `COUNT()`, `SUM()`, `AVG()`, `MIN()`, `MAX()`.

Синтаксис
```
SELECT column_name, AGGREGATE_FUNCTION(column_name)
FROM table_name
GROUP BY column_name;
```

#### Пример:
*Вывести количество заказов по каждому клиенту*
```
SELECT customer_id, COUNT(*) AS total_orders
FROM orders
GROUP BY customer_id;
```

## Оператор фильтрации HAVING

`HAVING` используется для фильтрации **уже агрегированных *, полученных с помощью `GROUP BY`. В отличие от `WHERE`, который фильтрует строки **до** группировки, `HAVING` применяется **после** группировки.

**ВНИМАНИЕ!**
`GROUP BY` может использоваться без `HAVING`, но `HAVING` никогда не используется без `GROUP BY`!

### Порядок следования операторов

| Порядок | Оператор  | Описание                                                      |
|---------|-----------|---------------------------------------------------------------|
| 1       | `SELECT`  | Определяет, какие столбцы или выражения должны быть выведены. |
| 2       | `DISTINCT`| Убирает дубликаты (логически выполняется после `SELECT`).     |
| 3       | `FROM`    | Определяет таблицу, из которой выбираются данные.             |
| 4       | `JOIN`    | Объединяет данные из нескольких таблиц.                       |
| 5       | `WHERE`   | Фильтрует строки **до** группировки.                          |
| 6       | `GROUP BY`| Группирует строки с одинаковыми значениями.                   |
| 7       | `HAVING`  | Фильтрует агрегированные данные **после** `GROUP BY`.         |
| 8       | `ORDER BY`| Сортирует результаты.                                         |
| 9       | `LIMIT`   | Ограничивает количество строк в выводе.                       |
| 10      | `OFFSET`  | Пропускает указанное количество строк перед выводом.          |



#### Примеры использования HAVING
*Выбрать только тех клиентов, которые сделали более чем 5 заказов*
```
SELECT 
    customer_id, COUNT(*) AS total_orders
FROM 
    orders
GROUP BY customer_id
HAVING total_orders > 5;
```

## Группировка с `WITH ROLLUP `

`WITH ROLLUP` — это опция в MySQL, которая добавляется к `GROUP BY`  
                для добавления промежуточных и итоговых строк (агрегатов),  
                включая общий итог (сумму, количество и т. п.).

```
SELECT 
    department_id, job_id, COUNT(*) AS film_count
FROM
    employees
GROUP BY department_id , job_id WITH ROLLUP;
```